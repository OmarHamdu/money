<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¹Ù…Ø± Ø§Ù„Ù…Ø§Ù„ÙŠ (Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„)</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f4f7f6;
            --sidebar-bg: linear-gradient(180deg, #2c3e50 0%, #3498db 100%);
            --card-bg: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --gold-color: #f1c40f;
            --radius: 15px;
            --shadow: 0 10px 30px rgba(0,0,0,0.05);
            --border-color: #eee;
        }

        body.dark-mode {
            --bg-color: #1a1a1a;
            --sidebar-bg: linear-gradient(180deg, #000000 0%, #1a1a1a 100%);
            --card-bg: #2d2d2d;
            --text-primary: #ecf0f1;
            --text-secondary: #bdc3c7;
            --border-color: #444;
            --shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        body {
            font-family: 'Tajawal', sans-serif;
            margin: 0; padding: 0; background-color: var(--bg-color); color: var(--text-primary);
            display: flex; min-height: 100vh; overflow-x: hidden; transition: 0.3s;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙÙ„ */
        #lock-screen {
            position: fixed; top: 0; right: 0; width: 100%; height: 100%;
            background: var(--sidebar-bg); z-index: 9999;
            display: flex; justify-content: center; align-items: center; flex-direction: column; color: white;
        }
        .pin-display { font-size: 2rem; letter-spacing: 10px; margin: 20px 0; background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 10px; min-width: 150px; text-align: center; height: 40px; }
        .numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .num-btn { width: 60px; height: 60px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.3); background: transparent; color: white; font-size: 1.5rem; cursor: pointer; transition: 0.2s; }
        .num-btn:hover { background: rgba(255,255,255,0.2); }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .sidebar { width: 260px; background: var(--sidebar-bg); color: white; padding: 20px 0; position: fixed; height: 100%; box-shadow: 4px 0 15px rgba(0,0,0,0.1); z-index: 1000; overflow-y: auto; }
        .sidebar h2 { text-align: center; margin-bottom: 20px; font-size: 1.6rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px; }
        .nav-btn { display: flex; align-items: center; width: 100%; padding: 14px 25px; background: none; border: none; color: rgba(255,255,255,0.9); text-align: right; font-size: 1rem; cursor: pointer; transition: 0.3s; font-family: 'Tajawal', sans-serif; border-right: 4px solid transparent; }
        .nav-btn:hover, .nav-btn.active { background-color: rgba(255,255,255,0.15); border-right-color: white; }
        .nav-btn span { margin-left: 10px; font-size: 1.2rem; }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        .main-content { margin-right: 260px; padding: 40px; width: 100%; transition: 0.3s; }
        .page { display: none; animation: slideUp 0.6s ease-out; }
        .page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-bottom: 40px; }
        .card { background: var(--card-bg); padding: 25px; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--border-color); position: relative; overflow: hidden; }
        .card h3 { margin-top: 0; color: var(--text-secondary); font-size: 1.1rem; }
        .card .amount { font-size: 2.2rem; font-weight: 700; margin-top: 15px; color: var(--text-primary); }
        .card.gold { border-bottom: 4px solid var(--gold-color); background: linear-gradient(135deg, var(--card-bg), #fffbf0); grid-column: 1 / -1; }
        body.dark-mode .card.gold { background: linear-gradient(135deg, var(--card-bg), #3a3000); }
        .card.gold .amount { color: #d4ac0d; font-size: 2.8rem; }
        .card.green { border-bottom: 4px solid var(--success-color); } .card.green .amount { color: var(--success-color); }
        .card.red { border-bottom: 4px solid var(--danger-color); } .card.red .amount { color: var(--danger-color); }
        .card.blue { border-bottom: 4px solid var(--accent-color); } .card.blue .amount { color: var(--accent-color); }
        .card.purple { border-bottom: 4px solid #9b59b6; } .card.purple .amount { color: #9b59b6; }

        /* Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø®Ø±Ù‰ */
        .input-group, .settings-group { background: var(--card-bg); padding: 25px; border-radius: var(--radius); box-shadow: var(--shadow); display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end; margin-bottom: 30px; border: 1px solid var(--border-color); }
        .form-control { flex: 1; min-width: 180px; }
        .form-control label { display: block; margin-bottom: 8px; font-weight: bold; }
        .form-control input, .form-control select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; background: var(--bg-color); color: var(--text-primary); box-sizing: border-box; font-family: 'Tajawal'; }
        .action-btn { padding: 12px 30px; background-color: var(--accent-color); color: white; border: none; border-radius: 8px; cursor: pointer; height: 46px; font-family: 'Tajawal'; font-weight: bold; }
        
        .table-container { background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow); overflow-x: auto; border: 1px solid var(--border-color); }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { text-align: right; padding: 15px; background: rgba(0,0,0,0.05); color: var(--text-primary); }
        td { padding: 15px; border-bottom: 1px solid var(--border-color); color: var(--text-primary); }
        .delete-btn { background: #ffebee; color: var(--danger-color); border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; }
        
        .settings-list { list-style: none; padding: 0; }
        .tag { background: var(--accent-color); color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.9rem; }

        @media (max-width: 900px) {
            .sidebar { width: 70px; } .sidebar h2, .nav-btn span { display: none; }
            .nav-btn { justify-content: center; padding: 20px 0; }
            .main-content { margin-right: 70px; padding: 20px; }
        }
    </style>
</head>
<body>

    <div id="lock-screen">
        <div style="margin-bottom: 20px;">ğŸ”’ Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø­Ù…Ø§ÙŠØ©</div>
        <div class="pin-display" id="pin-display"></div>
        <div class="numpad">
            <button class="num-btn" onclick="enterPin(1)">1</button>
            <button class="num-btn" onclick="enterPin(2)">2</button>
            <button class="num-btn" onclick="enterPin(3)">3</button>
            <button class="num-btn" onclick="enterPin(4)">4</button>
            <button class="num-btn" onclick="enterPin(5)">5</button>
            <button class="num-btn" onclick="enterPin(6)">6</button>
            <button class="num-btn" onclick="enterPin(7)">7</button>
            <button class="num-btn" onclick="enterPin(8)">8</button>
            <button class="num-btn" onclick="enterPin(9)">9</button>
            <button class="num-btn" onclick="resetPin()">C</button>
            <button class="num-btn" onclick="enterPin(0)">0</button>
            <button class="num-btn" style="background:var(--success-color); border:none;" onclick="checkPin()">ğŸ†—</button>
        </div>
    </div>

    <div class="sidebar">
        <h2>ğŸ‘¤ Ù†Ø¸Ø§Ù… Ø¹Ù…Ø±</h2>
        <button class="nav-btn active" onclick="showPage('home')"><span>ğŸ </span> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <button class="nav-btn" onclick="showPage('transfer')"><span>ğŸ”€</span> Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª</button>
        <button class="nav-btn" onclick="showPage('meeza')"><span>ğŸ’³</span> Ù…ÙŠØ²Ø©</button>
        <button class="nav-btn" onclick="showPage('fawry')"><span>âš¡</span> ÙÙˆØ±ÙŠ</button>
        <button class="nav-btn" onclick="showPage('personal')"><span>ğŸ“</span> Ù…ØµØ§Ø±ÙŠÙ</button>
        <button class="nav-btn" onclick="showPage('income')"><span>ğŸ’°</span> Ø§Ù„Ø¯Ø®Ù„</button>
        <button class="nav-btn" onclick="showPage('debts')"><span>ğŸ“‰</span> Ø¯ÙŠÙˆÙ†</button>
        <button class="nav-btn" onclick="showPage('credits')"><span>ğŸ“ˆ</span> Ø¯Ø§ÙŠÙ†</button>
        <button class="nav-btn" onclick="showPage('settings')"><span>âš™ï¸</span> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    </div>

    <div class="main-content">

        <div id="home" class="page active">
            <h1>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¹Ù…Ø± ğŸ‘‹</h1>
            <div class="dashboard-grid">
                <div class="card gold">
                    <h3>ğŸ’ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø«Ø±ÙˆØªÙƒ (ÙƒÙ„ Ù…Ø§ ØªÙ…Ù„Ùƒ)</h3>
                    <div class="amount" id="home-total-wealth">0 Ø¬.Ù…</div>
                </div>

                <div class="card green">
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒÙ„ Ø§Ù„Ù„ÙŠ Ø¯Ø®Ù„ ğŸ“¥</h3>
                    <div class="amount" id="home-grand-in">0 Ø¬.Ù…</div>
                </div>

                <div class="card red">
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ğŸ“¤</h3>
                    <div class="amount" id="home-grand-out">0 Ø¬.Ù…</div>
                </div>

                <div class="card blue">
                    <h3>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù…Ù† Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø­Ø± ğŸ’°</h3>
                    <div class="amount" id="home-net-income">0 Ø¬.Ù…</div>
                </div>

                <div class="card green">
                    <h3>ÙÙ„ÙˆØ³ Ù„ÙŠÙƒ (Ø§Ù„Ø¯Ø§ÙŠÙ†) ğŸ“ˆ</h3>
                    <div class="amount" id="home-credits-total">0 Ø¬.Ù…</div>
                </div>

                <div class="card red">
                    <h3>ÙÙ„ÙˆØ³ Ø¹Ù„ÙŠÙƒ (Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©) ğŸ“‰</h3>
                    <div class="amount" id="home-debts-total">0 Ø¬.Ù…</div>
                </div>
                
                <div class="card"><h3>Ø±ØµÙŠØ¯ Ù…ÙŠØ²Ø© ğŸ’³</h3><div class="amount" id="home-meeza-balance">0</div></div>
                <div class="card"><h3>Ø±ØµÙŠØ¯ ÙÙˆØ±ÙŠ âš¡</h3><div class="amount" id="home-fawry-balance">0</div></div>
            </div>
        </div>

        <div id="settings" class="page">
            <h1>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>
            <div class="settings-group" style="flex-direction: column; align-items: stretch;">
                <h3 style="margin-top:0">ğŸ·ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</h3>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="new-cat-input" placeholder="Ø§Ø³Ù… Ø§Ù„ØªØµÙ†ÙŠÙ (Ù…Ø«Ø§Ù„: Ø¬ÙŠÙ…ØŒ ÙƒÙˆØ±Ø³Ø§Øª)" style="padding: 10px; flex:1; border-radius:5px; border:1px solid #ccc;">
                    <button class="action-btn" onclick="addNewCategory()">Ø¥Ø¶Ø§ÙØ©</button>
                </div>
                <h4>Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h4>
                <div id="categories-list" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
            </div>

            <div class="settings-group" style="flex-direction: column; align-items: stretch;">
                <h3 style="margin-top:0">ğŸ” Ø§Ù„Ø£Ù…Ø§Ù† (ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±)</h3>
                <div style="display: flex; gap: 10px; align-items: flex-end;">
                    <div class="form-control"><label>Ø±Ù…Ø² Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯ (4 Ø£Ø±Ù‚Ø§Ù…)</label><input type="number" id="new-pin-input" placeholder="****"></div>
                    <button class="action-btn" onclick="changePin()">ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù…Ø²</button>
                </div>
            </div>

            <div class="settings-group" style="flex-direction: column; align-items: stretch;">
                <h3 style="margin-top:0">ğŸ’¾ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="action-btn" style="background:#34495e" onclick="toggleDarkMode()">ğŸŒ— Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</button>
                    <button class="action-btn" style="background:#27ae60" onclick="exportData()">ğŸ’¾ Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
                    <button class="action-btn" style="background:#e67e22" onclick="importData()">ğŸ“‚ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù†Ø³Ø®Ø©</button>
                    <button class="action-btn" style="background:#c0392b" onclick="resetData()">ğŸ—‘ï¸ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                </div>
            </div>
        </div>

        <div id="transfer" class="page">
            <h1>ğŸ”€ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„</h1>
            <div class="input-group" style="background: #e8f8f5; border: 1px solid #2ecc71;">
                <div class="form-control"><label>Ù…Ù† Ø­Ø³Ø§Ø¨</label><select id="transfer-from" onchange="updateTransferOptions()"><option value="cash">ğŸ’° Ø§Ù„ÙƒØ§Ø´ (Ø§Ù„Ø¯Ø®Ù„)</option><option value="meeza">ğŸ’³ Ù…ÙŠØ²Ø©</option></select></div>
                <div class="form-control"><label>Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨</label><select id="transfer-to"></select></div>
                <div class="form-control"><label>Ø§Ù„Ù…Ø¨Ù„Øº</label><input type="number" id="transfer-amount"></div>
                <button class="action-btn" onclick="executeTransfer()">Ù†ÙØ° Ø§Ù„ØªØ­ÙˆÙŠÙ„</button>
            </div>
        </div>

        <div id="meeza" class="page">
            <h1>ğŸ’³ Ù…ÙŠØ²Ø©</h1>
            <div class="dashboard-grid"><div class="card"><h3>Ø§Ù„Ø±ØµÙŠØ¯</h3><div class="amount" id="meeza-balance">0</div></div></div>
            <div class="input-group">
                <div class="form-control"><label>Ø§Ù„Ù†ÙˆØ¹</label><select id="meeza-type"><option value="in">Ø¥ÙŠØ¯Ø§Ø¹</option><option value="out">Ø³Ø­Ø¨</option></select></div>
                <div class="form-control"><label>Ø§Ù„Ù…Ø¨Ù„Øº</label><input type="number" id="meeza-amount"></div>
                <div class="form-control"><label>Ø§Ù„ØªØµÙ†ÙŠÙ</label><select id="meeza-cat" class="dynamic-cat"></select></div>
                <div class="form-control"><label>Ù…Ù„Ø§Ø­Ø¸Ø©</label><input type="text" id="meeza-note"></div>
                <button class="action-btn" onclick="addTransaction('meeza')">Ø­ÙØ¸</button>
            </div>
            <div class="table-container"><table><thead><tr><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th><th>Ø­Ø°Ù</th></tr></thead><tbody id="meeza-table"></tbody></table></div>
        </div>

        <div id="fawry" class="page">
            <h1>âš¡ ÙÙˆØ±ÙŠ</h1>
            <div class="dashboard-grid"><div class="card"><h3>Ø§Ù„Ø±ØµÙŠØ¯</h3><div class="amount" id="fawry-balance">0</div></div></div>
            <div class="input-group">
                <div class="form-control"><label>Ø§Ù„Ù†ÙˆØ¹</label><select id="fawry-type"><option value="in">Ø´Ø­Ù†</option><option value="out">Ø¯ÙØ¹</option></select></div>
                <div class="form-control"><label>Ø§Ù„Ù…Ø¨Ù„Øº</label><input type="number" id="fawry-amount"></div>
                <div class="form-control"><label>Ø§Ù„ØªØµÙ†ÙŠÙ</label><select id="fawry-cat" class="dynamic-cat"></select></div>
                <div class="form-control"><label>Ù…Ù„Ø§Ø­Ø¸Ø©</label><input type="text" id="fawry-note"></div>
                <button class="action-btn" onclick="addTransaction('fawry')">Ø­ÙØ¸</button>
            </div>
            <div class="table-container"><table><thead><tr><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th><th>Ø­Ø°Ù</th></tr></thead><tbody id="fawry-table"></tbody></table></div>
        </div>

        <div id="personal" class="page">
            <h1>ğŸ“ Ù…ØµØ§Ø±ÙŠÙ Ø´Ø®ØµÙŠØ©</h1>
            <div class="budget-container">
                <div style="display: flex; justify-content: space-between;"><h3>ğŸ¯ Ù‡Ø¯Ù Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</h3><input type="number" id="budget-limit" placeholder="Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰" onchange="setBudget()" style="width:100px; padding:5px;"></div>
                <div style="background:#eee; height:20px; border-radius:10px; margin-top:10px;"><div id="budget-bar" style="height:100%; width:0%; background:#27ae60; border-radius:10px; transition:0.5s;"></div></div>
            </div>
            <div class="input-group">
                <div class="form-control"><label>Ø§Ù„Ù…Ø¨Ù„Øº</label><input type="number" id="personal-amount"></div>
                <div class="form-control"><label>Ø§Ù„ØªØµÙ†ÙŠÙ</label><select id="personal-cat" class="dynamic-cat"></select></div>
                <div class="form-control"><label>Ù…Ù„Ø§Ø­Ø¸Ø©</label><input type="text" id="personal-note"></div>
                <button class="action-btn" onclick="addTransaction('personal')">Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ</button>
            </div>
            <div class="table-container"><table><thead><tr><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„ØªØµÙ†ÙŠÙ - Ù…Ù„Ø§Ø­Ø¸Ø©</th><th>Ø­Ø°Ù</th></tr></thead><tbody id="personal-table"></tbody></table></div>
        </div>

        <div id="income" class="page">
            <h1>ğŸ’° Ø§Ù„Ø¯Ø®Ù„</h1>
            <div class="input-group">
                <div class="form-control"><label>Ø§Ù„Ù…Ø¨Ù„Øº</label><input type="number" id="income-amount"></div>
                <div class="form-control"><label>Ø§Ù„Ù…ØµØ¯Ø±</label><input type="text" id="income-note"></div>
                <button class="action-btn" onclick="addTransaction('income')">Ø¥Ø¶Ø§ÙØ© Ø¯Ø®Ù„</button>
            </div>
            <div class="table-container"><table><thead><tr><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…ØµØ¯Ø±</th><th>Ø­Ø°Ù</th></tr></thead><tbody id="income-table"></tbody></table></div>
        </div>

        <div id="debts" class="page">
            <h1>ğŸ“‰ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©</h1>
            <div class="input-group"><div class="form-control"><label>Ø§Ù„Ù…Ø¨Ù„Øº</label><input type="number" id="debts-amount"></div><div class="form-control"><label>Ø§Ù„Ø¯Ø§Ø¦Ù†</label><input type="text" id="debts-note"></div><button class="action-btn" onclick="addTransaction('debts')">ØªØ³Ø¬ÙŠÙ„</button></div>
            <div class="table-container"><table><thead><tr><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø¯Ø§Ø¦Ù†</th><th>Ø­Ø°Ù</th></tr></thead><tbody id="debts-table"></tbody></table></div>
        </div>

        <div id="credits" class="page">
            <h1>ğŸ“ˆ Ø§Ù„Ø¯Ø§ÙŠÙ†</h1>
            <div class="input-group"><div class="form-control"><label>Ø§Ù„Ù…Ø¨Ù„Øº</label><input type="number" id="credits-amount"></div><div class="form-control"><label>Ø§Ù„Ù…Ø¯ÙŠÙ†</label><input type="text" id="credits-note"></div><button class="action-btn" onclick="addTransaction('credits')">ØªØ³Ø¬ÙŠÙ„</button></div>
            <div class="table-container"><table><thead><tr><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ø¯ÙŠÙ†</th><th>Ø­Ø°Ù</th></tr></thead><tbody id="credits-table"></tbody></table></div>
        </div>

    </div>

    <script>
        let appData = { meeza: [], fawry: [], personal: [], income: [], debts: [], credits: [] };
        let settings = { 
            budget: 0, 
            pin: '0000', 
            darkMode: false,
            categories: ['Ø·Ø¹Ø§Ù… ğŸ”', 'Ù…ÙˆØ§ØµÙ„Ø§Øª ğŸšŒ', 'ÙÙˆØ§ØªÙŠØ± ğŸ“±', 'Ø¬Ø§Ù…Ø¹Ø© ğŸ“š', 'ØªØ­ÙˆÙŠÙ„Ø§Øª ğŸ”€', 'Ø£Ø®Ø±Ù‰'] 
        };
        let currentPin = '';

        window.onload = function() {
            if(localStorage.getItem('omarFinancePro')) appData = { ...appData, ...JSON.parse(localStorage.getItem('omarFinancePro')) };
            if(localStorage.getItem('omarSettings')) settings = { ...settings, ...JSON.parse(localStorage.getItem('omarSettings')) };

            if(settings.darkMode) document.body.classList.add('dark-mode');
            document.getElementById('budget-limit').value = settings.budget;

            populateCategories();
            updateTransferOptions();

            if(sessionStorage.getItem('unlocked')) document.getElementById('lock-screen').style.display = 'none';
            
            updateAllViews();
        };

        function populateCategories() {
            document.querySelectorAll('.dynamic-cat').forEach(select => {
                select.innerHTML = '';
                settings.categories.forEach(cat => {
                    let option = document.createElement('option');
                    option.value = cat;
                    option.text = cat;
                    select.appendChild(option);
                });
            });
            let listDiv = document.getElementById('categories-list');
            listDiv.innerHTML = '';
            settings.categories.forEach(cat => {
                let tag = document.createElement('span');
                tag.className = 'tag';
                tag.innerHTML = `${cat} <span style="cursor:pointer; margin-right:5px;" onclick="removeCategory('${cat}')">âŒ</span>`;
                listDiv.appendChild(tag);
            });
        }

        function addNewCategory() {
            let input = document.getElementById('new-cat-input');
            let newCat = input.value.trim();
            if(newCat && !settings.categories.includes(newCat)) {
                settings.categories.push(newCat);
                saveSettings(); populateCategories();
                input.value = ''; alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©!');
            }
        }

        function removeCategory(cat) {
            if(confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙØŸ')) {
                settings.categories = settings.categories.filter(c => c !== cat);
                saveSettings(); populateCategories();
            }
        }

        function changePin() {
            let input = document.getElementById('new-pin-input');
            let newPin = input.value;
            if(newPin.length === 4) {
                settings.pin = newPin; saveSettings();
                input.value = ''; alert('ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù…Ø²!');
            } else { alert('ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 4 Ø£Ø±Ù‚Ø§Ù…'); }
        }

        function enterPin(num) { if(currentPin.length < 4) { currentPin += num; updatePinDisplay(); } }
        function resetPin() { currentPin = ''; updatePinDisplay(); }
        function updatePinDisplay() { document.getElementById('pin-display').innerText = '*'.repeat(currentPin.length); }
        function checkPin() {
            if(currentPin === settings.pin) {
                document.getElementById('lock-screen').style.display = 'none';
                sessionStorage.setItem('unlocked', 'true');
            } else { alert('Ø±Ù…Ø² Ø®Ø·Ø£!'); currentPin = ''; updatePinDisplay(); }
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            updateAllViews();
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            settings.darkMode = document.body.classList.contains('dark-mode');
            saveSettings();
        }

        function setBudget() {
            settings.budget = parseFloat(document.getElementById('budget-limit').value);
            saveSettings(); updateAllViews();
        }

        function saveSettings() { localStorage.setItem('omarSettings', JSON.stringify(settings)); }

        function addTransaction(cat, manualData = null) {
            let amount, desc, type, date = new Date().toLocaleDateString('ar-EG');
            if(manualData) {
                amount = manualData.amount; desc = manualData.desc; type = manualData.type;
            } else {
                let amtInput = document.getElementById(`${cat}-amount`);
                let noteInput = document.getElementById(`${cat}-note`) || document.getElementById(`${cat}-desc`);
                let catInput = document.getElementById(`${cat}-cat`);
                let typeInput = document.getElementById(`${cat}-type`);

                amount = parseFloat(amtInput.value);
                let note = noteInput ? noteInput.value : '';
                let category = catInput ? catInput.value : '';
                desc = category ? `${category} - ${note}` : note;
                type = typeInput ? typeInput.value : 'single';

                if (isNaN(amount) || amount <= 0) { alert('Ø§Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­'); return; }
                amtInput.value = ''; if(noteInput) noteInput.value = '';
            }
            appData[cat].push({ id: Date.now(), amount, desc, type, date });
            localStorage.setItem('omarFinancePro', JSON.stringify(appData));
            updateAllViews();
        }

        function deleteTransaction(cat, id) {
            if(confirm('Ø­Ø°ÙØŸ')) {
                appData[cat] = appData[cat].filter(item => item.id !== id);
                localStorage.setItem('omarFinancePro', JSON.stringify(appData));
                updateAllViews();
            }
        }

        function updateTransferOptions() {
            let from = document.getElementById('transfer-from').value;
            let to = document.getElementById('transfer-to');
            to.innerHTML = '';
            if(from === 'cash') to.innerHTML += '<option value="meeza">ğŸ’³ Ù…ÙŠØ²Ø©</option>';
            else if(from === 'meeza') to.innerHTML += '<option value="fawry">âš¡ ÙÙˆØ±ÙŠ</option>';
        }

        function executeTransfer() {
            let from = document.getElementById('transfer-from').value;
            let to = document.getElementById('transfer-to').value;
            let amount = parseFloat(document.getElementById('transfer-amount').value);
            if(isNaN(amount) || amount <= 0) return;

            if(from === 'cash') addTransaction('personal', { amount, desc: `ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ${to}`, type: 'single' });
            else if (from === 'meeza') addTransaction('meeza', { amount, desc: `ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ${to}`, type: 'out' });

            if(to === 'meeza') addTransaction('meeza', { amount, desc: `ØªØ­ÙˆÙŠÙ„ Ù…Ù† ${from}`, type: 'in' });
            else if (to === 'fawry') addTransaction('fawry', { amount, desc: `ØªØ­ÙˆÙŠÙ„ Ù…Ù† ${from}`, type: 'in' });

            document.getElementById('transfer-amount').value = '';
            alert('ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„!');
        }

        function updateAllViews() {
            ['meeza', 'fawry', 'personal', 'income', 'debts', 'credits'].forEach(cat => updateCatView(cat));
            updateSummary();
        }

        function updateCatView(cat) {
            let tbody = document.getElementById(`${cat}-table`);
            if(!tbody) return;
            tbody.innerHTML = '';
            let totalIn = 0, totalOut = 0;
            [...appData[cat]].reverse().forEach(item => {
                if(item.type === 'in') totalIn += item.amount; else if(item.type === 'out') totalOut += item.amount;
                tbody.innerHTML += `<tr><td>${item.type==='in'?'<span style="color:green">+</span>':item.type==='out'?'<span style="color:red">-</span>':''} ${item.amount}</td><td>${item.date}</td><td>${item.desc}</td><td><button class="delete-btn" onclick="deleteTransaction('${cat}', ${item.id})">x</button></td></tr>`;
            });
            let balance = totalIn - totalOut;
            if(document.getElementById(`${cat}-balance`)) document.getElementById(`${cat}-balance`).innerText = balance;
        }

        function updateSummary() {
            let meezaBal = sum(appData.meeza, 'in') - sum(appData.meeza, 'out');
            let fawryBal = sum(appData.fawry, 'in') - sum(appData.fawry, 'out');
            let income = appData.income.reduce((a,b)=>a+b.amount,0);
            let personal = appData.personal.reduce((a,b)=>a+b.amount,0);
            let debts = appData.debts.reduce((a,b)=>a+b.amount,0);
            let credits = appData.credits.reduce((a,b)=>a+b.amount,0);
            let netIncome = income - personal;

            // Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ÙƒÙ„ÙŠØ©
            let grandIn = income + sum(appData.meeza, 'in') + sum(appData.fawry, 'in');
            let grandOut = personal + sum(appData.meeza, 'out') + sum(appData.fawry, 'out');
            let wealth = meezaBal + fawryBal + credits + netIncome;

            setTxt('home-total-wealth', wealth);
            setTxt('home-grand-in', grandIn);
            setTxt('home-grand-out', grandOut);
            setTxt('home-net-income', netIncome);
            setTxt('home-meeza-balance', meezaBal);
            setTxt('home-fawry-balance', fawryBal);
            setTxt('home-credits-total', credits);
            setTxt('home-debts-total', debts);

            if(settings.budget > 0) {
                let percent = (personal / settings.budget) * 100;
                document.getElementById('budget-bar').style.width = Math.min(percent, 100) + '%';
            }
        }

        function sum(arr, type) { return arr.filter(i => i.type === type).reduce((a, b) => a + b.amount, 0); }
        function setTxt(id, val) { if(document.getElementById(id)) document.getElementById(id).innerText = val.toLocaleString() + " Ø¬.Ù…"; }
        
        function exportData() {
            let dataStr = JSON.stringify({ data: appData, settings: settings });
            let link = document.createElement('a');
            link.href = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            link.download = 'omar_backup.json';
            link.click();
        }
        function importData() {
            let input = document.createElement('input'); input.type = 'file';
            input.onchange = e => {
                let reader = new FileReader();
                reader.onload = ev => {
                    let imported = JSON.parse(ev.target.result);
                    appData = imported.data; settings = imported.settings;
                    localStorage.setItem('omarFinancePro', JSON.stringify(appData));
                    localStorage.setItem('omarSettings', JSON.stringify(settings));
                    location.reload();
                };
                reader.readAsText(e.target.files[0]);
            };
            input.click();
        }
        function resetData() { if(confirm('ØªØµÙÙŠØ± ÙƒÙ„ Ø´ÙŠØ¡ØŸ')) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>
